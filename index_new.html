<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modifier Trial Scheduler</title>
  <link
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Orbitron:wght@400;700;900&family=Inter:wght@400;500;600&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --bg: #05070a;
      --surface: #0c1016;
      --surface2: #121820;
      --border: #1e2d3d;
      --accent: #00d4ff;
      --accent-glow: rgba(0, 212, 255, 0.4);
      --accent2: #7c3aed;
      --live: #00ff88;
      --text: #e1e7ed;
      --muted: #6e7a8a;
      --tag-bg: rgba(0, 212, 255, 0.1);
      --sidebar-width: 260px;
      --header-height: 80px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }

    /* Grid noise texture overlay */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(0, 212, 255, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 212, 255, 0.02) 1px, transparent 1px);
      background-size: 50px 50px;
      pointer-events: none;
      z-index: 0;
    }

    header {
      position: relative;
      padding: 0 40px;
      height: var(--header-height);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(12, 16, 22, 0.8);
      backdrop-filter: blur(12px);
      z-index: 10;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo-hex {
      width: 32px;
      height: 32px;
      background: var(--accent);
      clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 15px var(--accent-glow);
    }

    .logo-text {
      display: flex;
      flex-direction: column;
    }

    .logo-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 16px;
      font-weight: 800;
      letter-spacing: 2px;
      color: var(--accent);
      text-transform: uppercase;
    }

    .logo-sub {
      font-size: 9px;
      color: var(--muted);
      letter-spacing: 1.5px;
      text-transform: uppercase;
      font-family: 'JetBrains Mono', monospace;
    }

    .clock {
      text-align: right;
      font-family: 'JetBrains Mono', monospace;
    }

    .clock-time {
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
    }

    .clock-date {
      font-size: 10px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    main {
      display: flex;
      flex: 1;
      position: relative;
      z-index: 1;
    }

    /* SIDEBAR */
    aside {
      width: var(--sidebar-width);
      flex-shrink: 0;
      border-right: 1px solid var(--border);
      padding: 30px 20px;
      background: var(--surface);
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease;
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }

    .sidebar-label {
      font-size: 10px;
      color: var(--muted);
      letter-spacing: 2px;
      text-transform: uppercase;
      font-weight: 600;
    }

    #toggle-all {
      font-size: 9px;
      color: var(--accent);
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-family: 'JetBrains Mono', monospace;
    }

    #toggle-all:hover {
      opacity: 0.8;
      text-decoration: underline;
    }

    .mod-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      overflow-y: auto;
      padding-right: 5px;
    }

    .mod-item {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      padding: 10px 12px;
      border-radius: 8px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      font-family: 'JetBrains Mono', monospace;
    }

    .mod-item:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    .mod-item.active {
      background: rgba(0, 212, 255, 0.06);
    }

    .mod-checkbox {
      width: 16px;
      height: 16px;
      border: 1.5px solid var(--border);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      background: var(--surface2);
    }

    .mod-item.active .mod-checkbox {
      border-color: var(--accent);
      background: var(--accent);
      box-shadow: 0 0 8px var(--accent-glow);
    }

    .mod-checkbox svg {
      display: none;
      width: 10px;
      height: 10px;
      stroke: var(--bg);
    }

    .mod-item.active .mod-checkbox svg {
      display: block;
    }

    .mod-name {
      font-size: 13px;
      color: var(--muted);
    }

    .mod-item.active .mod-name {
      color: var(--text);
      font-weight: 500;
    }

    /* CONTENT */
    .content {
      flex: 1;
      padding: 30px 40px;
      overflow-y: auto;
      background: linear-gradient(135deg, rgba(12, 16, 22, 0.4) 0%, transparent 100%);
    }

    .content-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 30px;
    }

    .content-title {
      font-size: 11px;
      color: var(--muted);
      letter-spacing: 3px;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .title-accent {
      width: 3px;
      height: 18px;
      background: var(--accent);
      border-radius: 2px;
      box-shadow: 0 0 10px var(--accent-glow);
    }

    .result-count {
      font-size: 11px;
      color: var(--muted);
      background: var(--surface);
      padding: 4px 12px;
      border-radius: 20px;
      border: 1px solid var(--border);
    }

    .result-count span {
      color: var(--accent);
      font-weight: 600;
    }

    /* TABLE */
    .table-wrapper {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-family: 'JetBrains Mono', monospace;
    }

    th {
      padding: 16px 24px;
      text-align: left;
      font-size: 10px;
      font-weight: 600;
      color: var(--muted);
      letter-spacing: 1.5px;
      text-transform: uppercase;
      background: var(--surface2);
      border-bottom: 1px solid var(--border);
    }

    tbody tr {
      border-bottom: 1px solid rgba(30, 45, 61, 0.4);
      transition: background 0.15s;
    }

    tbody tr:last-child {
      border-bottom: none;
    }

    tbody tr:hover {
      background: rgba(0, 212, 255, 0.02);
    }

    td {
      padding: 18px 24px;
      font-size: 13px;
      vertical-align: middle;
    }

    .mod-tag {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      background: var(--tag-bg);
      color: var(--accent);
      border: 1px solid rgba(0, 212, 255, 0.1);
      text-transform: uppercase;
    }

    .time-cell {
      color: var(--text);
    }

    .countdown-cell {
      color: var(--accent);
      font-weight: 600;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 5px 12px;
      border-radius: 30px;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    .status-badge.upcoming {
      background: rgba(110, 122, 138, 0.1);
      color: var(--muted);
      border: 1px solid rgba(110, 122, 138, 0.2);
    }

    .status-badge.live {
      background: rgba(0, 255, 136, 0.1);
      color: var(--live);
      border: 1px solid rgba(0, 255, 136, 0.2);
    }

    .live-dot {
      width: 6px;
      height: 6px;
      background: var(--live);
      border-radius: 50%;
      box-shadow: 0 0 8px var(--live);
      animation: blink 1.2s ease-in-out infinite;
    }

    @keyframes blink {

      0%,
      100% {
        opacity: 1;
        transform: scale(1);
      }

      50% {
        opacity: 0.4;
        transform: scale(0.8);
      }
    }

    /* EMPTY STATE */
    .empty-state {
      text-align: center;
      padding: 100px 40px;
      color: var(--muted);
    }

    .empty-icon {
      font-size: 48px;
      margin-bottom: 20px;
      opacity: 0.2;
      font-family: 'Orbitron', sans-serif;
    }

    /* MEDIA QUERIES (The Fix) */
    @media (max-width: 900px) {
      header {
        padding: 0 20px;
      }

      main {
        flex-direction: column;
      }

      aside {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid var(--border);
        padding: 20px;
      }

      .mod-list {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }

      .mod-item {
        flex: 1 1 auto;
        min-width: 120px;
        justify-content: center;
        padding: 8px;
        background: var(--surface2);
        border: 1px solid var(--border);
      }

      .content {
        padding: 25px 20px;
      }

      .table-wrapper {
        margin: 0 -10px;
        border-radius: 0;
        border-left: none;
        border-right: none;
        overflow-x: auto;
      }
    }

    @media (max-width: 600px) {
      header {
        height: auto;
        padding: 20px;
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }

      .clock {
        text-align: left;
      }

      .content-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      th,
      td {
        padding: 12px 15px;
      }

      .status-badge {
        padding: 4px 8px;
      }

      .status-badge span {
        display: none;
      }

      /* Hide text in badge if too small */
      .status-badge::after {
        content: attr(data-short);
      }
    }

    /* Scrollbar Customization */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--muted);
    }
  </style>
</head>

<body>

  <header>
    <div class="logo">
      <div class="logo-hex"></div>
      <div class="logo-text">
        <div class="logo-title">Modifier Scheduler</div>
        <div class="logo-sub">Rotation Intelligence v2.1</div>
      </div>
    </div>
    <div class="clock">
      <div class="clock-time" id="clock-time">--:--:--</div>
      <div class="clock-date" id="clock-date">---</div>
    </div>
  </header>

  <main>
    <aside>
      <div class="sidebar-header">
        <div class="sidebar-label">Target Filters</div>
        <div id="toggle-all">Select/Clear All</div>
      </div>
      <div class="mod-list" id="mod-list"></div>
    </aside>

    <div class="content">
      <div class="content-header">
        <div class="content-title">
          <div class="title-accent"></div>
          Deployment Timeline
        </div>
        <div class="result-count">Tracked: <span id="result-count">0</span></div>
      </div>

      <div class="table-wrapper">
        <table id="main-table">
          <thead>
            <tr>
              <th>Modifier</th>
              <th>Window</th>
              <th>Countdown</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="table-body">
          </tbody>
        </table>

        <div class="empty-state" id="empty-state" style="display:none">
          <div class="empty-icon">â¬¡</div>
          <div>No tactical modifiers selected</div>
          <div style="margin-top:8px;font-size:12px;opacity:0.6">Initialize tracking by selecting active mods from the
            interface.</div>
        </div>
      </div>
    </div>
  </main>

  <script>
    const MODIFIERS = [
      "Speedy", "Glass", "Quarantine", "Fog", "Limit",
      "Flying", "Jailed", "Exploding", "Inflation",
      "Commited", "Hidden", "Broke", "Healthy"
    ];

    // Use UTC for the anchor time to ensure global synchronization.
    // 19:00 GMT+7 is 12:00 UTC.
    const ANCHOR_TIME = new Date(Date.UTC(2026, 1, 20, 12, 0, 0));
    const ANCHOR_MODIFIER = "Exploding";
    const INTERVAL_HOURS = 3;
    const MAX_PER_MOD = 5;

    // Persistent Selection Logic
    const STORAGE_KEY = 'modifier_tracker_selected';
    let selected = new Set();

    function loadSettings() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          const arr = JSON.parse(saved);
          selected = new Set(arr);
        } catch (e) {
          selected = new Set(["Commited", "Glass", "Quarantine"]);
        }
      } else {
        selected = new Set(["Commited", "Glass", "Quarantine"]);
      }
    }

    function saveSettings() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify([...selected]));
    }

    function getRotationData(now) {
      // Comparison of Date objects uses UTC timestamps, so this is timezone-independent
      const diffMs = now - ANCHOR_TIME;
      const slotMs = INTERVAL_HOURS * 3600 * 1000;
      const totalSlots = Math.floor(diffMs / slotMs);
      const anchorIdx = MODIFIERS.indexOf(ANCHOR_MODIFIER);
      const currentIdx = ((anchorIdx + totalSlots) % MODIFIERS.length + MODIFIERS.length) % MODIFIERS.length;
      const msIntoSlot = diffMs % slotMs;
      // currentStart in local time
      const currentStart = new Date(now - msIntoSlot);
      return { currentIdx, currentStart };
    }

    function formatCountdown(target, now) {
      if (target <= now) return "LIVE";
      const diff = target - now;
      const days = Math.floor(diff / 86400000);
      const hours = Math.floor((diff % 86400000) / 3600000);
      const mins = Math.floor((diff % 3600000) / 60000);
      const parts = [];
      if (days > 0) parts.push(`${days}d`);
      if (hours > 0 || days > 0) parts.push(`${hours}h`);
      parts.push(`${mins}m`);
      return parts.join(" ");
    }

    function formatDateTime(d) {
      const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
      const day = String(d.getDate()).padStart(2, '0');
      const h = String(d.getHours()).padStart(2, '0');
      const m = String(d.getMinutes()).padStart(2, '0');
      return `${months[d.getMonth()]} ${day}, ${h}:${m}`;
    }

    function buildSidebar() {
      const list = document.getElementById('mod-list');
      const toggleBtn = document.getElementById('toggle-all');

      toggleBtn.onclick = () => {
        if (selected.size === MODIFIERS.length) {
          selected.clear();
        } else {
          MODIFIERS.forEach(mod => selected.add(mod));
        }
        saveSettings();
        buildSidebar();
        renderTable();
      };

      list.innerHTML = '';
      for (const mod of MODIFIERS) {
        const item = document.createElement('div');
        item.className = 'mod-item' + (selected.has(mod) ? ' active' : '');
        item.dataset.mod = mod;
        item.innerHTML = `
      <div class="mod-checkbox">
        <svg viewBox="0 0 10 8" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1 4L3.5 6.5L9 1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <span class="mod-name">${mod}</span>`;

        item.addEventListener('click', () => {
          if (selected.has(mod)) selected.delete(mod);
          else selected.add(mod);
          saveSettings();
          item.classList.toggle('active');
          renderTable();
        });
        list.appendChild(item);
      }
    }

    function renderTable() {
      const tbody = document.getElementById('table-body');
      const empty = document.getElementById('empty-state');
      const countEl = document.getElementById('result-count');
      const table = document.getElementById('main-table');

      if (selected.size === 0) {
        empty.style.display = 'block';
        table.style.display = 'none';
        countEl.textContent = '0';
        return;
      }

      empty.style.display = 'none';
      table.style.display = 'table';
      tbody.innerHTML = '';

      const now = new Date();
      const { currentIdx, currentStart } = getRotationData(now);

      const results = [];
      const counts = {};
      for (const m of selected) counts[m] = 0;

      for (let i = 0; i < 250; i++) {
        const checkIdx = (currentIdx + i) % MODIFIERS.length;
        const mod = MODIFIERS[checkIdx];
        if (!selected.has(mod)) continue;
        if (counts[mod] >= MAX_PER_MOD) continue;

        const slotTime = new Date(currentStart.getTime() + i * INTERVAL_HOURS * 3600000);
        const isActuallyLive = i === 0 && (now - slotTime < INTERVAL_HOURS * 3600000);

        results.push({ mod, time: slotTime, live: isActuallyLive });
        counts[mod]++;
      }

      results.sort((a, b) => a.time - b.time);
      countEl.textContent = results.length;

      for (const { mod, time, live } of results) {
        const tr = document.createElement('tr');
        const cdValue = formatCountdown(time, now);
        const isLive = cdValue === "LIVE";

        tr.innerHTML = `
      <td><span class="mod-tag">${mod}</span></td>
      <td class="time-cell">${formatDateTime(time)}</td>
      <td class="countdown-cell">${isLive ? 'ACTIVE' : cdValue}</td>
      <td>
        ${isLive
            ? `<span class="status-badge live" data-short="LIVE"><div class="live-dot"></div><span>Live Now</span></span>`
            : `<span class="status-badge upcoming" data-short="UPCM"><span>Upcoming</span></span>`}
      </td>`;
        tbody.appendChild(tr);
      }
    }

    function updateClock() {
      const now = new Date();
      const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
      const days = ["SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"];

      const h = String(now.getHours()).padStart(2, '0');
      const m = String(now.getMinutes()).padStart(2, '0');
      const s = String(now.getSeconds()).padStart(2, '0');

      // Get timezone offset string (e.g., GMT+0700)
      const tzMatch = now.toTimeString().match(/([A-Z]+[\+-]\d+)/);
      const tzString = tzMatch ? tzMatch[1] : "";

      document.getElementById('clock-time').textContent = `${h}:${m}:${s}`;
      document.getElementById('clock-date').textContent =
        `${days[now.getDay()]} // ${months[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()} // ${tzString}`;
    }

    // Init
    loadSettings();
    buildSidebar();
    renderTable();
    updateClock();
    setInterval(updateClock, 1000);
    setInterval(renderTable, 30000);
  </script>
</body>

</html>